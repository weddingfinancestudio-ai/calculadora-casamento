<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Or√ßamento de Casamento</title>
  <meta name="description" content="Landing page ligada ao seu Excel. Calcule o or√ßamento total ou quantos convidados cabem no seu or√ßamento.">
  <!-- Tipografia (opcional) -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#fffaf4; --card:#ffffff; --text:#0f172a; --muted:#6b7280; --border:#e5e7eb; --shadow:0 8px 24px rgba(0,0,0,.06); --accent:#16a34a; --info:#0ea5e9 }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system;background:var(--bg);color:var(--text)}
    .container{max-width:1080px;margin:0 auto;padding:28px}
    header{display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:700}
    .hero{padding:40px 0}
    h1{font-size:40px;line-height:1.1;margin:0 0 12px}
    p.lead{font-size:18px;color:var(--muted);margin:0 0 20px}
    .cta{display:flex;gap:12px;flex-wrap:wrap}
    .btn{background:var(--text);color:#fff;border:none;padding:12px 18px;border-radius:12px;cursor:pointer}
    .btn.alt{background:#fff;color:var(--text);border:1px solid var(--border)}
    .badge{display:inline-block;background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46;padding:6px 10px;border-radius:999px;font-weight:600;font-size:12px;margin-top:8px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:24px 0}
    .panel{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:18px}
    label{display:block;margin:12px 0;font-weight:600}
    select,input[type="range"],input[type="number"]{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;background:#fff}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .chip{border:1px solid var(--border);background:#f8fafc;padding:8px 12px;border-radius:24px;cursor:pointer}
    .card{border-radius:14px;padding:16px;margin-bottom:12px;border:1px solid var(--border)}
    .card.success{background:#ecfdf5;border-color:#bbf7d0}
    .card.info{background:#eff6ff;border-color:#bfdbfe}
    .value{font-size:24px;font-weight:700}
    .value.big{font-size:36px}
    .muted{color:var(--muted)}
    ul.clean{list-style:none;margin:0;padding:0}
    ul.clean li{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px dashed var(--border)}
    footer{margin:40px 0;color:var(--muted);font-size:14px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">WeddingBudget PT</div>
      <nav><a class="btn alt" href="#calc">Usar Calculadora</a></nav>
    </header>

    <section class="hero">
      <h1>Calculadora de Or√ßamento de Casamento</h1>
      <p class="lead">Resultados autom√°ticos a partir do seu Excel: estime o total ou descubra quantos convidados cabem no seu or√ßamento.</p>
      <div class="cta">
        <a class="btn" href="#calc">Usar Calculadora</a>
        <a class="btn alt" href="#faq">Perguntas frequentes</a>
      </div>
      <div class="badge">Gratuito ‚Ä¢ Sem registo</div>
    </section>

    <section id="calc" class="grid">
      <div class="panel">
        <div class="tabs">
          <button class="chip" id="tab1">Quanto posso gastar?</button>
          <button class="chip" id="tab2">Que casamento posso ter?</button>
        </div>

        <label>Distrito
          <select id="distrito"></select>
        </label>

        <label>Tipo de cerim√≥nia
          <select id="cerimonia">
            <option>Registo Civil - Cart√≥rio</option>
            <option selected>Registo Civil - Externo</option>
            <option>Igreja</option>
          </select>
        </label>

        <label>Estilo
          <select id="estilo"></select>
        </label>

        <div id="grupo1">
          <label>N√∫mero de convidados
            <input id="convidados" type="range" min="10" max="800" value="100" step="5">
          </label>
        </div>

        <div id="grupo2" style="display:none">
          <label>Or√ßamento dispon√≠vel (‚Ç¨)
            <input id="orcamento" type="number" value="20000" step="500" min="0">
          </label>
        </div>
      </div>

      <div class="panel" id="saida">
        <div class="muted">A carregar dados do Excel‚Ä¶</div>
      </div>
    </section>

    <section id="faq" class="panel">
      <h2>Perguntas frequentes</h2>
      <p><b>De onde v√™m os valores?</b> Da folha ‚ÄúPar√¢metros‚Äù do seu Excel (colunas: Categoria, Distrito, Estilo, Valor, TipoValor).</p>
      <p><b>Como atualizo?</b> Substitua o ficheiro <code>base.xlsx</code> e recarregue a p√°gina.</p>
      <p><b>Posso ter breakdown 100% igual ao Excel?</b> Sim ‚Äî este script usa a mesma regra PP/TT e a cerim√≥nia √© escolhida pela op√ß√£o acima.</p>
    </section>

    <footer>¬© <span id="ano"></span> WeddingBudget PT ‚Äî Feito com üíö</footer>
  </div>

  <!-- SheetJS para ler Excel no navegador -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <script>
    // üëâ O seu Excel est√° na RAIZ, mesmo n√≠vel do index.html
    const EXCEL_URL = 'base.xlsx';

    const CATEGORIES_PP = ['Espa√ßos','Convites','Lembran√ßas'];
    const CATEGORIES_TT = ['Fotografia','V√≠deo','M√∫sica & Anima√ß√£o','Decora√ß√£o & Flores','Noiva','Noivo','Transporte'];
    const CERIMONIAS = ['Registo Civil - Cart√≥rio','Registo Civil - Externo','Igreja'];

    const state = {
      modo: 'quanto_posso_gastar',
      distrito: null,
      estilo: null,
      cerimonia: 'Registo Civil - Externo',
      convidados: 100,
      orcamento: 20000,
      linhas: [] // {Categoria, Distrito, Estilo, Valor, TipoValor}
    };

    const fmtEUR = v => v.toLocaleString('pt-PT',{style:'currency',currency:'EUR'});

    document.getElementById('ano').textContent = new Date().getFullYear();
    document.getElementById('tab1').addEventListener('click', () => setModo('quanto_posso_gastar'));
    document.getElementById('tab2').addEventListener('click', () => setModo('que_casamento_posso_ter'));
    document.getElementById('convidados').addEventListener('input', e => { state.convidados = Number(e.target.value); render(); });
    document.getElementById('orcamento').addEventListener('change', e => { state.orcamento = Number(e.target.value); render(); });
    document.getElementById('distrito').addEventListener('change', e => { state.distrito = e.target.value; syncEstilos(); render(); });
    document.getElementById('estilo').addEventListener('change', e => { state.estilo = e.target.value; render(); });
    document.getElementById('cerimonia').addEventListener('change', e => { state.cerimonia = e.target.value; render(); });

    function setModo(m) {
      state.modo = m;
      document.getElementById('grupo1').style.display = (m === 'quanto_posso_gastar') ? '' : 'none';
      document.getElementById('grupo2').style.display = (m === 'que_casamento_posso_ter') ? '' : 'none';
      render();
    }

    async function loadExcel(){
      try{
        const resp = await fetch(EXCEL_URL, {cache:'no-store'});
        if(!resp.ok) throw new Error('N√£o foi poss√≠vel descarregar o Excel ('+resp.status+').');
        const ab = await resp.arrayBuffer();
        const wb = XLSX.read(ab, {type:'array'});

        const wsname = wb.SheetNames.includes('Par√¢metros') ? 'Par√¢metros' : wb.SheetNames[0];
        const ws = wb.Sheets[wsname];
        const all = XLSX.utils.sheet_to_json(ws, {defval:null});

        state.linhas = all.filter(r =>
          r.Categoria && r.Distrito && r.Estilo && r.Valor != null && r.TipoValor &&
          (r.TipoValor === 'PP' || r.TipoValor === 'TT') &&
          !Number.isNaN(Number(r.Valor))
        ).map(r => ({
          Categoria: String(r.Categoria).trim(),
          Distrito: String(r.Distrito).trim(),
          Estilo: String(r.Estilo).trim(),
          Valor: Number(r.Valor),
          TipoValor: String(r.TipoValor).trim()
        }));

        populateDropdowns();
        render();
      }catch(err){
        document.getElementById('saida').innerHTML =
          '<div class="card">'+err.message+'<br><span class="muted">Confirme o caminho do ficheiro e a folha ‚ÄúPar√¢metros‚Äù.</span></div>';
        console.error(err);
      }
    }

    function unique(a){ return [...new Set(a)]; }

    function populateDropdowns(){
      const distritos = unique(state.linhas.map(x => x.Distrito)).sort();
      const estilos = unique(state.linhas.map(x => x.Estilo)).sort();

      const selD = document.getElementById('distrito');
      selD.innerHTML = '';
      distritos.forEach(d => selD.add(new Option(d, d)));
      state.distrito = state.distrito ?? distritos[0];

      const selE = document.getElementById('estilo');
      selE.innerHTML = '';
      estilos.forEach(e => selE.add(new Option(e, e)));
      state.estilo = state.estilo ?? estilos[0];
    }

    function syncEstilos(){
      const estilos = unique(state.linhas.filter(x => x.Distrito===state.distrito).map(x=>x.Estilo)).sort();
      const selE = document.getElementById('estilo');
      selE.innerHTML = '';
      estilos.forEach(e => selE.add(new Option(e, e)));
      if(!estilos.includes(state.estilo)) state.estilo = estilos[0] || null;
    }

    function getValor(cat, distrito, estilo, tipo){
      const row = state.linhas.find(r => r.Categoria===cat && r.Distrito===distrito && r.Estilo===estilo && r.TipoValor===tipo);
      return row ? row.Valor : 0;
    }

    function calcTotal(distrito, estilo, convidados, cerimonia){
      let total = 0;
      const breakdown = [];

      // PP
      let somaPP = 0;
      for(const cat of CATEGORIES_PP){
        const v = getValor(cat,distrito,estilo,'PP');
        const sub = v * convidados;
        somaPP += v;
        total += sub;
        breakdown.push([cat, sub]);
      }
      // TT
      for(const cat of CATEGORIES_TT){
        const v = getValor(cat,distrito,estilo,'TT');
        total += v;
        breakdown.push([cat, v]);
      }
      // Cerim√≥nia (uma s√≥)
      if(CERIMONIAS.includes(cerimonia)){
        const v = getValor(cerimonia, distrito, estilo, 'TT');
        total += v;
        breakdown.push([cerimonia, v]);
      }

      return { total, somaPP, breakdown };
    }

    function render(){
      const out = document.getElementById('saida');
      if(!state.linhas.length){ out.innerHTML = '<div class="muted">Sem dados‚Ä¶</div>'; return; }

      if(state.modo === 'quanto_posso_gastar'){
        const { total, somaPP, breakdown } = calcTotal(state.distrito, state.estilo, state.convidados, state.cerimonia);
        out.innerHTML = `
          <div class="card success">
            <div class="value">${fmtEUR(total)}</div>
            <div class="muted">‚âà ${fmtEUR(somaPP)} por pessoa (s√≥ itens PP)</div>
          </div>
          <ul class="clean">
            ${breakdown.map(([k,v]) => `<li><span>${k}</span><span>${fmtEUR(v)}</span></li>`).join('')}
          </ul>`;
      } else {
        // Que casamento posso ter? -> calcular convidados poss√≠veis por estilo
        const estilos = unique(state.linhas.filter(x => x.Distrito===state.distrito).map(x=>x.Estilo)).sort();
        const cards = estilos.map(est => {
          // Somat√≥rios por estilo
          let pp = 0, tt = 0;
          for(const cat of CATEGORIES_PP) pp += getValor(cat, state.distrito, est, 'PP');
          for(const cat of CATEGORIES_TT) tt += getValor(cat, state.distrito, est, 'TT');
          // cerim√≥nia
          tt += getValor(state.cerimonia, state.distrito, est, 'TT');
          const possiveis = pp>0 ? Math.floor(Math.max(0, (state.orcamento - tt)) / pp) : 0;
          return `
            <div class="card info">
              <div class="muted">Estilo</div>
              <div class="value">${est}</div>
              <div class="muted">‚Ç¨ / pessoa (PP)</div>
              <div class="value">${fmtEUR(pp)}</div>
              <div class="muted">Convidados poss√≠veis</div>
              <div class="value big">${possiveis}</div>
            </div>`;
        }).join('');
        out.innerHTML = `
          <div class="card">
            <div class="muted">Or√ßamento</div>
            <div class="value">${fmtEUR(state.orcamento)}</div>
            <div class="muted">Inclui ${state.cerimonia} e todos os itens TT.</div>
          </div>
          ${cards}`;
      }
    }

    // Arranque
    loadExcel();
  </script>
</body>
</html>
